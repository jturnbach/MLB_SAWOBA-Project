---
title: "Early EDA"
output: html_notebook
---

Packages
```{r}
library(tidyverse)
library(ggplot2)
library(scatterplot3d)
#library(rgl) I can't download this package but it is supposed to make the 3d scatterplot interactive
```

Data
```{r}
at_bat <- read.csv("C:/Users/lucas/OneDrive - The Pennsylvania State University/DS 440/DS440/at_bat.csv")
head(at_bat)
```
```{r}
#grouping the out categories
at_bat <- at_bat %>%
  mutate(events_gr = case_when(
    events %in% c("fielders_choice_out", "force_out", "grounded_into_double_play",
                  "sac_fly", "fielders_choice", "triple_play", "double_play",
                  "sac_fly_double_play") ~ "field_out",
    TRUE ~ events
  ))

unique(at_bat$events_gr)
unique(at_bat$events)
```

Univariate
```{r}
cat("Launch Angle 5 Number Summary\n")
summary(at_bat$launch_angle)

cat("\nExit Velocity 5 Number Summary\n")
summary(at_bat$launch_speed)
```

```{r}
hist(at_bat$launch_angle, 
     main = "Histogram of Launch Angle",
     xlab = "Launch Angle",
     ylab = "Frequency"
)

hist(at_bat$launch_speed, 
     main = "Histogram of Exit Velocity",
     xlab = "Exit Velocity",
     ylab = "Frequency"
)
```
Launch angle is pretty normal which you would come to expect seeing that all players want to hit the ball coming across it or that is what they are aiming to do. Exit velocity is left skewed with a median of 91, which also makes sense as players do need to hit the ball hard and well to have a ball in play. 

```{r}
#spray angle percentage:
at_bat <- at_bat %>%
  mutate(pull = case_when(
    stand == "R" & spray_angle < -20 ~ "pulled",
    stand == "R" & spray_angle >= -20 & spray_angle <= 20 ~ "center",
    stand == "R" & spray_angle > 20 ~ "opposite",
    stand == "L" & spray_angle < -20 ~ "opposite",
    stand == "L" & spray_angle >= -20 & spray_angle <= 20 ~ "center",
    stand == "L" & spray_angle > 20 ~ "pulled",
    TRUE ~ NA_character_  # Handle other cases if any
  ))

pulled_percentages <- at_bat %>%
  group_by(stand) %>%
  summarise(pulled_percentage = sum(pull == "pulled") / n() * 100)

print(pulled_percentages)

events_of_interest <- c("field_out", "single", "double", "home_run", "triple")
filtered_data <- at_bat %>%
  filter(events_gr %in% events_of_interest)

ggplot(filtered_data, aes(x = pull, fill = events_gr)) +
  geom_bar(position = "fill", stat = "count") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  labs(title = "Percentage of Events by Pull",
       x = "Pull",
       y = "Percentage") +
  scale_fill_manual(values = c("field_out" = "blue", 
                               "single" = "green", 
                               "double" = "orange", 
                               "home_run" = "red", 
                               "triple" = "purple"))
```



Bivariate
```{r}
#only out, single, double, triple, HR
main_events <- c("field_out", "single", "double", "triple", "home_run")

custom_colors <- c(field_out = "blue", single = "yellow", double = "orange", triple = "green", home_run = "red")

subset_data <- subset(at_bat, events %in% main_events)

plot(subset_data$launch_speed, 
     subset_data$launch_angle, 
     col = custom_colors[subset_data$events],
     main = "Scatterplot of Launch Speed vs Launch Angle With Outs",
     xlab = "Launch Speed",
     ylab = "Launch Angle"
)

legend("topright",
       legend = names(custom_colors), 
       col = custom_colors, 
       title = "Event",
       pch = 16,
       cex = 0.8
)
```

```{r}

scatterplot3d(subset_data$launch_speed, 
              subset_data$launch_angle, 
              subset_data$spray_angle, 
              color = custom_colors[subset_data$events],
              main = "3D Scatterplot of Launch Speed, Launch Angle, and Spray Angle",
              xlab = "Launch Speed",
              ylab = "Launch Angle",
              zlab = "Spray Angle"
)


legend("topright",
       legend = names(custom_colors), 
       fill = custom_colors,
       title = "Event",
       cex = 0.8
)

#rglwidget()
```
```{r}
#only out, single, double, triple, HR
main_events <- c("field_out", "single", "double", "triple", "home_run")

custom_colors <- c(field_out = "blue", single = "yellow", double = "orange", triple = "green", home_run = "red")

subset_data <- subset(at_bat, events %in% main_events)

plot(subset_data$launch_speed, 
     subset_data$spray_angle, 
     col = custom_colors[subset_data$events],
     main = "Scatterplot of Launch Speed vs Spray Angle With Outs",
     xlab = "Launch Speed",
     ylab = "Spray Angle"
)

legend("topright",
       legend = names(custom_colors), 
       col = custom_colors, 
       title = "Event",
       pch = 16,
       cex = 0.8
)
```
You can see that people are getting more home runs at around -40 and 40 when looking at the spray angle. The pulled balls (around -40) also seem to get more singles as they are going more down towards the gap in fielding positions. 

```{r}
#summary(at_bat$sprint_speed)
at_bat <- at_bat %>%
  mutate(sprint_speed_cat = case_when(
    sprint_speed < 26.3 ~ "slow",
    sprint_speed >= 26.3 & sprint_speed <= 28.3 ~ "average",
    sprint_speed > 28.3 ~ "fast",
    TRUE ~ NA_character_  # Handle other cases if any
  ))

main_events <- c("field_out", "single", "double", "triple", "home_run")

custom_colors <- c(field_out = "blue", single = "yellow", double = "orange", triple = "green", home_run = "red")

subset_data <- subset(at_bat, events %in% main_events)

ground_ball_data <- subset_data %>%
  filter(bb_type == "ground_ball")

# Calculate the percentage of hitters for each combination of events and sprint_speed_cat
summary_data <- ground_ball_data %>%
  group_by(events, sprint_speed_cat) %>%
  summarise(percentage = n() / nrow(ground_ball_data) * 100)

ggplot(summary_data, aes(x = sprint_speed_cat, y = percentage, fill = events)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  labs(title = "Percentage of Hitters with Single, Double, or Triple for Ground Balls",
       x = "Sprint Speed Category",
       y = "Percentage") +
  scale_fill_manual(values = c("single" = "blue", "double" = "orange", "triple" = "green", "field_out" = "grey"))
'''
ggplot(summary_data, aes(x = "", y = percentage, fill = events)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar(theta = "y") +
  facet_wrap(~sprint_speed_cat) +
  labs(title = "Percentage of Hitters with Single, Double, or Triple for Ground Balls",
       x = NULL,
       y = NULL) +
  scale_fill_manual(values = c("single" = "blue", "double" = "orange", "triple" = "green", "field_out" = "grey"))
  '''
```

